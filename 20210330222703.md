

[TOC]



# 准备工作

## 软件安装

> 安装保持默认即可，安装软件顺序同下，因为eNSP自带的版本低，还不如自动安装最新的。eNSP可以调用1和2两个工具
>
> eNSP官网论坛：https://forum.huawei.com/enterprise/zh/thread-707405.html

1. 下载Virtualbox
2. 下载Wireshark
3. 下载eNSP：https://support.huawei.com/enterprise/zh/tool

## eNSP初识

1. G比特接口“`GEC`”：接路由器
2. 兆比特网口：用来接主机
3. "WAN"接口，即广域网接口，路由器之间的接入
4. 工具栏工具



# 搭建环境

## 注意事项

1. 搭建环境时，先规划，后配置

2. 接口不够可以打开设置，进行模块拖拽，进行接口添加

3. 连线时，一定要对应，并且记住所接的接口

4. 实验需要一定的文本标识，便于清楚的看到，每个模块的网段等，利于调试

5.  网段常从网光开始分配

   ![image-20210324165955441](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221720.png)

6. 配置好后，记得保存好配置

7. 子网掩码为`255.255.255.0`

## 路由器配置

1. 进入系统视图

   注意，进入系统试图有个好处就是，简写用tab键能自动补全

   ```
   system-view
   ```

2. 修改路由器名称

   ```
   sysname 名称
   ```

3. 接口配置命令

   ```
   示例：进入Vlanif 1 接口
   interface Vlanif 1
   进入GBit接口
   interface GigabitEthernet 0/0/0
   ```

   ```
   为接口添加ip地址
   ip address 192.168.1.1 24
   或者
   ip address 192.168.1.1 255.255.255.0
   即子网掩码可以是24 或者直接填255.255.255.0
   ```

4. 当该接口已经有ip地址，删除该地址

   ```
   undo ip address
   ```

5. 查看该接口配置的ip地址

   ```
   dispay this
   ```

6. 退出，返回上一层

   ```
   quit
   ```

7. 命令后面跟着`？`可以查看手册

   ```
   例如：查看ip address的帮助手册
   ip address ?
   ```

8. 检查两者是否能ping通

   ```
   ping 另一台ip地址
   ```

9. DNS可以指定可以不指定

10. ![image-20210324174535307](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221721.png)

11.   查看路由器的配置

    ```
    display current-configuration
    ```

12. 路由器里的配置都是保存在内存里的，保存需要使用命令

    ```
    save
    ```

    我们导出的配置，就是save之后出现的文件配置即`vrpcfg.zip`文件

    所以必须得先保存，再导出

13. 查看路由器目录下文件

    ```
    dir
    ```

14. 到处配置只能一个一个导出

    右击鼠标即可

## 提示命令无法识别解决方法

遇到这种问题有两种情况

- 命令输错了
- 没有退出用户模式

1. 命令输错

   - 检查错误

2. 退出用户模式

   - 输入quit退出到用户模式/或者按`Ctrl+Z`

   - 调用命令

     ![image-20210324211036447](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221722.png)

     

## 使网络畅通

> 使得网络保持畅通的要点
>
> - 保证网络有去有回
> - 路由器默认只知道直连的网段
> - 没有直连的需要管理员添加静态路由

1. 查看现有静态路由表

   ```
   display ip touting-table
   ```

   Direct代表是直连的

2. 添加静态路由

   ```
   前面的是ip是目的区域的IP段，后面的是到达目的地需要经过的下一跳ip段，即经过端
   ip route-static 20.1.2.0 .24 20.1.1.2
   ```

3. 跟踪数据包

   ```
   跟踪数据包流向
   tracert 192.168.2.2
   ```

   # 排除网络故障

   ## 抓包

   > 抓包右击之后，Wireshark将会被调用,故障排除就是使用抓包捕获数据的过程

   

   
   
   ## 配置用户
   
    ```
   进入aaa模式
   配置用户列表/添加用户 用户名RTB 密码aaa
   local-user RTB password cipher aaa
   配置服务类型为ppp
   local-user RTB service-type ppp
   授权pap认证
   authentication-scheme pap
    ```
   
   ---------------------------
   
# 具体实验过程

   > 泪奔，经过实验，我才知道这有命令参考的玩意，命令需要经过具体的路由器进行配置，指导书和实际操作的其实是两个玩意，命令啥的有部分是不能直接执行的，需要更换相同的命令，这是此次ppp协议我走过最多的坑。

   ## 搭建PPP准备工作

   1. [S5700 V200R001C00 命令参考.chm](D:\Software\Tim\S5700 V200R001C00 命令参考.chm) 
   
      这套命令参考文档用于查询正确的命令书写方式，当遇到一些无法被识别的正确命令时，可以在参考文档里查询，这里面会告诉你该命令需要在那个模式下配置，怎样的书写规则。
   
   2. eNSP环境
   
      ![image-20210325222009052](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221723.png)
   
   3. 使用的路由器 Router路由器
   
      ![image-20210325222256042](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221724.png)
   
   4. 使用的接线 Serial线
   
      ![image-20210325222540115](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221725.png)




## PPP协议配置的具体实验过程

> 相关过程为了便于同学做实验，所有的步骤仿照实验指导书，在群里发的那个pdf的过程
>

### 准备工作

1. 拖拽两个Router到空白区

2. 鼠标选中Serial线，将两个路由器连接起来

   选中Serial线后，光标会变形，此时点击路由器就会出现如图的界面，我们选中Serial线接入的第一个接口为Serial 0/0/0

   ![image-20210325224114014](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221726.png)

   接下来点击R2路由器，为选择连接到Serial 0/0/0接口

   ![image-20210325224533579](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221727.png)

3. 用文本提前标记两者ip地址

   ![image-20210325224847310](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221728.png)

4. 设置接口标签显示

   设置->总是显示接口标签

   ![image-20210325225026513](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221729.png)

### 配置IP

1. 启动路由器

   两种方法：

   - one by one ：以此右击路由器，选择启动按钮
   - 一键启动：点击菜单栏开始按钮，一个绿色的▶按钮

   ![image-20210325225733081](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221730.png)

   

2. 双击（右击路由器->CLI）进入路由器命令窗口

   此时，路由器出现`###`字符，表示正在启动中，请耐心等待一段时间

   ![image-20210325230012208](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221731.png)
   
3. 进入用户视图，配置路由器名称

   输入`system-view`进入用户视图，输入`sysname R1`将路由器命名为R1，如图：
   
   ![image-20210328104313416](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221732.png)
   
4.  进入接口，为接口配置ip
   
   输入`interface s 0/0/0`（注：这里是简写，也可以写全称Serial 0/0/0）进入Serial 0/0/0这个接口。
   
   输入`ip address 192.0.0.1 24`为该接口添加192.0.0.1这个ip地址，后面的24表示掩码为255.255.255.0，当然，你也可以哦通过全称`ip address 192.0.0.1 255.255.255.0`来添加ip。
   
   ![image-20210328104909904](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221733.png)
   
5. R2执行相似的过程

   修改名称、添加ip、都是一样的，但需要多一步——设置链路协议为ppp

   通过`link-protocol ppp`配置链路协议为PPP

   （笔者注：图中出现的一长串信息为路由器自动产生，而笔者非输入指令，产生这种信息的原因，笔者未知其缘由，忘读者不惜赐教)

   ![image-20210328110152411](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221734.png)

6. 检测，如图所示，则表示R2配置成功

   ![image-20210328110718068](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221735.png)

7. 配置完成，重新启动接口使之生效

   在`[R1-Serial0/0/0]`接口下输入`shutdown`

   执行完成后再输入`undo shutdown`

8. Ping两路由器，检测是否能通

   在R1中直接输入`ping 192.0.0.2`回车后查看相关信息

   ![image-20210328111457110](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221736.png)



## 配置路由器之间的PPP的身份认证

路由器R1以PAP的方式验证路由器R2,R1作为主验证方、R2作为被验证方，用户名为RTB密码为aaa，配置时注意区分大小写。

### 通过PAP的方式进行验证

1. 路由器R1配置

   进入AAA模式，添加用户RTB

   ```
   aaa
   local-user RTB password cipher aaa
   ```

   ![image-20210328194606439](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221737.png)

2. 配置服务类型为PPP

   输入`local-user RTB service-type ppp`配置服务类型为PPP模式

   ![image-20210328194839984](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221738.png)
   
3. 授权PAP验证

   输入`authentication-scheme PAP`授权PAP验证

   ![image-20210328195354992](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221739.png)

4. 路由器2配置

   进入AAA模式，输入`local-user RTB password cipher aaa`添加新用户RTB
   
   ![image-20210328200441591](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221740.png)
   
5. 重启接口

   输入`shutdown `关闭端口，输入`undo shutdown`启用端口

   ![image-20210328200738313](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221741.png)

6. Ping一下

   ![image-20210328200833890](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221742.png)

7. 通过数据抓包进行分析

### 通过CHAP进行验证

1. 添加本地用户，配置服务类型为PPP

   使用`local-user RTB password cipher aaa`添加用户

   使用`local-user RTB service-type ppp`配置服务类型为PPP

   ![image-20210328221627366](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221743.png)

2. 授权CHAP验证

   输入`authentication-scheme chap`授权CHAP验证方式

   ![image-20210328221924472](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221744.png)

3. 配置本地名称

   输入`quit`命令或按`Ctrl+Z`回退后进入到接口界面，输入`ppp chap user RTA`配置本地用户
   
   ![image-20210328223040659](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221745.png)
   
4. 路由器R2配置
   
   配置用户类型，添加用户RTA，密码为aaa,配置服务类型为PPP
   
   ![image-20210328223537397](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221746.png)
   
5. 进入接口，配置本地名称为RTB
   
   ![image-20210328223804835](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221747.png)
   
6. 重启端口
   
   在端口界面输入`shutdown`,之后再输入`undo shutdown`
   
   ![image-20210328223936845](https://raw.githubusercontent.com/Miubai/imgBed/cnblog_eNSP/20210330221748.png)
   
   
   
   
   
   
   
   
   
   